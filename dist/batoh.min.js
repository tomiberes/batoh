!function(t,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():t.Batoh=r()}(this,function(){"use strict";var t={},r=t.IndexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,n=(t.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||{READ_WRITE:"readwrite"},t.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,t.IDBCursor=window.IDBCursor=window.IDBCursor||window.webkitIDBCursor||window.mozIDBCursor||window.msIDBCursor,t.MODE={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"}),e=t.isFunction=function(t){return"function"==typeof t||!1},o=t.Database=function(t){t=t||{},this.setup={database:"Batoh",version:1,stores:{store:{keyPath:null,autoIncrement:!0,indexes:[]}}};for(var r in this.setup)this.setup[r]="undefined"!=typeof t[r]?t[r]:this.setup[r];this.idb=null};return o.prototype={open:function(t){var n,o=this;try{n=r.open(o.setup.database,o.setup.version)}catch(i){if(e(t))return t(i)}n.onsuccess=function(r){return o.idb=r.target.result,e(t)?t(null):void 0},n.onerror=function(r){return e(t)?t(r.target.error):void 0},n.onblocked=function(r){return e(t)?t(r.target.error):void 0},n.onupgradeneeded=function(r){try{var n=r.target.result;for(var i in o.setup.stores){var u=o.setup.stores[i],a=n.createObjectStore(i,{keyPath:u.keyPath,autoIncrement:u.autoIncrement});for(var s in u.indexes){var c=u.indexes[s];a.createIndex(c.name,c.keyPath,{unique:c.unique,multiEntry:c.multiEntry})}}}catch(d){if(e(t))return t(d)}}},close:function(){this.idb&&(this.idb.close(),this.idb=null)},destroy:function(t){if(r.deleteDatabase){var n=r.deleteDatabase(this.setup.database);n.onsuccess=function(r){return e(t)?t(null,r.target.result):void 0},n.onerror=function(t){},n.onblocked=function(t){},n.onversionchange=function(t){}}},transaction:function(t,r,n,o){var i;try{i=this.idb.transaction(t,r)}catch(u){if(e(o))return o(u)}return i.onabort=function(t){return e(o)?o(t.target.error):void 0},i.onerror=function(t){return e(o)?o(t.target.error):void 0},i.oncomplete=function(t){return e(o)?o(null,n):void 0},i},store:function(t,r,n){try{return r.objectStore(t)}catch(o){if(e(n))return n(o)}},add:function(t,r,o,i){var u={};4===arguments.length&&(Array.isArray(o)?u.key=o:u.key=[o]),3===arguments.length&&(i=o,o=null),Array.isArray(r)?u.value=r:u.value=[r];for(var a=[],s=this.transaction(t,n.READ_WRITE,a,i),c=this.store(t,s,i),d=function(t,r){var n;try{n=c.add(t,r)}catch(o){if(e(i))return i(o)}n.onsuccess=function(t){a.push(t.target.result)},n.onerror=function(t){return e(i)?i(t.target.error):void 0}},f=0,l=u.value.length;l>f;f++)u.key?d(u.value[f],u.key[f]):d(u.value[f])},put:function(t,r,o,i){var u={};4===arguments.length&&(Array.isArray(o)?u.key=o:u.key=[o]),3===arguments.length&&(i=o,o=null),Array.isArray(r)?u.value=r:u.value=[r];for(var a=[],s=this.transaction(t,n.READ_WRITE,a,i),c=this.store(t,s,i),d=function(t,r){var n;try{n=c.put(t,r)}catch(o){if(e(i))return i(o)}n.onsuccess=function(t){a.push(t.target.result)},n.onerror=function(t){return e(i)?i(t.target.error):void 0}},f=0,l=u.value.length;l>f;f++)u.key?d(u.value[f],u.key[f]):d(u.value[f])},get:function(t,r,o){Array.isArray(r)||(r=[r]);for(var i=[],u=this.transaction(t,n.READ_ONLY,i,o),a=this.store(t,u,o),s=function(t){var r;try{r=a.get(t)}catch(n){if(e(o))return o(n)}r.onsuccess=function(t){i.push(t.target.result)},r.onerror=function(t){return e(o)?o(t.target.error):void 0}},c=0,d=r.length;d>c;c++)s(r[c])},"delete":function(t,r,o){Array.isArray(r)||(r=[r]);for(var i=[],u=this.transaction(t,n.READ_WRITE,i,o),a=this.store(t,u,o),s=function(t){var r;try{r=a["delete"](t)}catch(n){if(e(o))return o(n)}r.onsuccess=function(t){i.push(t.target.result)},r.onerror=function(t){return e(o)?o(t.target.error):void 0}},c=0,d=r.length;d>c;c++)s(r[c])},query:function(t,r,o,i){3===arguments.length&&(i=o,o=null),2===arguments.length&&(i=r,r=null,o=null);var u,a=[],s=this.transaction(t,n.READ_ONLY,a,i),c=this.store(t,s,i),d=c;try{if(null!==r&&r.index&&(d=c.index(r.index)),null!==r&&r.limit)var f=r.limit;u=null===r?d.openCursor():d.openCursor(r.range,r.direction)}catch(l){if(e(i))return i(l)}u.onsuccess=function(t){var r=t.target.result;if(r){if(e(o)?a.push(o(r.value)):a.push(r.value),f&&(f--,0===f))return;try{r["continue"]()}catch(n){if(e(i))return i(n)}}},u.onerror=function(t){return e(i)?i(t.target.error):void 0}},count:function(t,r){var o,i,u=this.transaction(t,n.READ_ONLY,o,r),a=this.store(t,u,r);try{i=a.count()}catch(s){if(e(r))return r(s)}i.onsuccess=function(t){o=t.target.result},i.onerror=function(t){return e(r)?r(t.target.error):void 0}},clear:function(t,r){var o,i,u=this.transaction(t,n.READ_WRITE,o,r),a=this.store(t,u,r);try{i=a.clear()}catch(s){if(e(r))return r(s)}i.onsuccess=function(t){o=t.target.result},i.onerror=function(t){return e(r)?r(t.target.error):void 0}}},t});