!function(n,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():n.Batoh=t()}(this,function(){"use strict";{var n=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;window.IDBTransaction||window.webkitIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange||window.webkitIDBKeyRange}window.IDBCursor=window.IDBCursor||window.webkitIDBCursor||window.mozIDBCursor||window.msIDBCursor;var t={},e=t.Pocket=function(n){n=n||{},this.setup={database:"Batoh",version:1,stores:{store:{keyPath:null,autoIncrement:!0,indexes:[]}}};for(var t in this.setup)this.setup[t]="undefined"!=typeof n[t]?n[t]:this.setup[t];this.db=null};return e.prototype={openDB:function(t){var e=this,r=n.open(e.setup.database,e.setup.version);r.onsuccess=function(n){e.db=n.target.result,t&&"function"==typeof t&&t(null)},r.onerror=function(n){t&&"function"==typeof t&&t(n.target.error)},r.onblocked=function(n){t&&"function"==typeof t&&t(n.target.error)},r.onupgradeneeded=function(n){e.db=n.target.result;for(var t in e.setup.stores){var r=e.setup.stores[t],o=e.db.createObjectStore(t,{keyPath:r.keyPath,autoIncrement:r.autoIncrement});for(var u in r.indexes)o.createIndex(r.indexes[u].name,r.indexes[u].keyPath)}}},closeDB:function(){this.db&&this.db.close()},deleteDB:function(t){if(n.deleteDatabase){var e=n.deleteDatabase(this.setup.database);e.onsuccess=function(n){return t&&"function"==typeof t?t(null,n.target.result):void 0},e.onerror=function(){},e.onblocked=function(){},e.onversionchange=function(){}}},add:function(n,t,e,r){var o={};4===arguments.length&&(o.key=Array.isArray(e)?e:[e]),3===arguments.length&&(r=e,e=null),o.value=Array.isArray(t)?t:[t];var u=[],i=this.db.transaction(n,"readwrite");i.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},i.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},i.oncomplete=function(){return r&&"function"==typeof r?(u=1===u.length?u[0]:u,r(null,u)):void 0};for(var a=i.objectStore(n),c=function(n,t){var e=a.add(n,t);e.onsuccess=function(n){u.push(n.target.result)},e.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},f=0;f<o.value.length;f++)o.key?c(o.value[f],o.key[f]):c(o.value[f])},get:function(n,t,e){var r=this.db.transaction(n,"readonly");r.onabort=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},r.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},r.oncomplete=function(){return e&&"function"==typeof e?e(null,i):void 0};var o=r.objectStore(n),u=o.get(t),i=null;u.onsuccess=function(n){i=n.target.result},u.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0}},query:function(n,t,e,r){3===arguments.length&&(r=e,e=null),2===arguments.length&&(r=t,t=null,e=null);var o=[],u=this.db.transaction(n,"readonly");u.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},u.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},u.oncomplete=function(){return r&&"function"==typeof r?r(null,o):void 0};var i=u.objectStore(n),a=i;if(null!==t&&t.index&&(a=i.index(t.index)),null!==t&&t.limit)var c=t.limit;var f;f=null===t?a.openCursor():a.openCursor(t.range,t.direction),f.onsuccess=function(n){var t=n.target.result;if(t){if(e?e(t.value):o.push(t.value),c&&(c--,0===c))return;t.continue()}},f.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},put:function(n,t,e,r){var o={};4===arguments.length&&(o.key=Array.isArray(e)?e:[e]),3===arguments.length&&(r=e,e=null),o.value=Array.isArray(t)?t:[t];var u=[],i=this.db.transaction(n,"readwrite");i.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},i.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},i.oncomplete=function(){return u=1===u.length?u[0]:u,r&&"function"==typeof r?r(null,u):void 0};for(var a=i.objectStore(n),c=function(n,t){var e=a.put(n,t);e.onsuccess=function(n){u.push(n.target.result)},e.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},f=0;f<o.value.length;f++)o.key?c(o.value[f],o.key[f]):c(o.value[f])},"delete":function(n,t,e){var r=this.db.transaction(n,"readwrite");r.onabort=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},r.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},r.oncomplete=function(){return e&&"function"==typeof e?e(null):void 0};var o=r.objectStore(n),u=o.delete(t);u.onsuccess=function(){},u.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0}},clear:function(n,t){var e=this.db.transaction(n,"readwrite");e.onabort=function(n){return t&&"function"==typeof t?t(n.target.error):void 0},e.onerror=function(n){return t&&"function"==typeof t?t(n.target.error):void 0},e.oncomplete=function(){return t&&"function"==typeof t?t(null):void 0};var r=e.objectStore(n),o=r.clear();o.onsuccess=function(){},o.onerror=function(n){return t&&"function"==typeof t?t(n.target.error):void 0}}},t});