!function(n,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():n.Batoh=t()}(this,function(){"use strict";var n={};n.IndexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,n.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||{READ_WRITE:"readwrite"},n.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,n.IDBCursor=window.IDBCursor=window.IDBCursor||window.webkitIDBCursor||window.mozIDBCursor||window.msIDBCursor;var t={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},e=n.Pocket=function(n){n=n||{},this.setup={database:"Batoh",version:1,stores:{store:{keyPath:null,autoIncrement:!0,indexes:[]}}};for(var t in this.setup)this.setup[t]="undefined"!=typeof n[t]?n[t]:this.setup[t];this.db=null};return e.prototype={openDB:function(t){var e=this,r=n.IndexedDB.open(e.setup.database,e.setup.version);r.onsuccess=function(n){e.db=n.target.result,t&&"function"==typeof t&&t(null)},r.onerror=function(n){t&&"function"==typeof t&&t(n.target.error)},r.onblocked=function(n){t&&"function"==typeof t&&t(n.target.error)},r.onupgradeneeded=function(n){e.db=n.target.result;for(var t in e.setup.stores){var r=e.setup.stores[t],o=e.db.createObjectStore(t,{keyPath:r.keyPath,autoIncrement:r.autoIncrement});for(var u in r.indexes){var i=r.indexes[u];o.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multiEntry})}}}},closeDB:function(){this.db&&this.db.close()},deleteDB:function(t){if(n.IndexedDB.deleteDatabase){var e=n.IndexedDB.deleteDatabase(this.setup.database);e.onsuccess=function(n){return t&&"function"==typeof t?t(null,n.target.result):void 0},e.onerror=function(){},e.onblocked=function(){},e.onversionchange=function(){}}},add:function(n,e,r,o){var u={};4===arguments.length&&(u.key=Array.isArray(r)?r:[r]),3===arguments.length&&(o=r,r=null),u.value=Array.isArray(e)?e:[e];var i=[],a=this.db.transaction(n,t.READ_WRITE);a.onabort=function(n){return o&&"function"==typeof o?o(n.target.error):void 0},a.onerror=function(n){return o&&"function"==typeof o?o(n.target.error):void 0},a.oncomplete=function(){return o&&"function"==typeof o?(i=1===i.length?i[0]:i,o(null,i)):void 0};for(var c=a.objectStore(n),f=function(n,t){var e=c.add(n,t);e.onsuccess=function(n){i.push(n.target.result)},e.onerror=function(n){return o&&"function"==typeof o?o(n.target.error):void 0}},s=0;s<u.value.length;s++)u.key?f(u.value[s],u.key[s]):f(u.value[s])},get:function(n,e,r){var o=this.db.transaction(n,t.READ_ONLY);o.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},o.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},o.oncomplete=function(){return r&&"function"==typeof r?r(null,a):void 0};var u=o.objectStore(n),i=u.get(e),a=null;i.onsuccess=function(n){a=n.target.result},i.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},query:function(n,e,r,o){3===arguments.length&&(o=r,r=null),2===arguments.length&&(o=e,e=null,r=null);var u=[],i=this.db.transaction(n,t.READ_ONLY);i.onabort=function(n){return o&&"function"==typeof o?o(n.target.error):void 0},i.onerror=function(n){return o&&"function"==typeof o?o(n.target.error):void 0},i.oncomplete=function(){return o&&"function"==typeof o?o(null,u):void 0};var a=i.objectStore(n),c=a;if(null!==e&&e.index&&(c=a.index(e.index)),null!==e&&e.limit)var f=e.limit;var s;s=null===e?c.openCursor():c.openCursor(e.range,e.direction),s.onsuccess=function(n){var t=n.target.result;if(t){if(r?r(t.value):u.push(t.value),f&&(f--,0===f))return;t.continue()}},s.onerror=function(n){return o&&"function"==typeof o?o(n.target.error):void 0}},put:function(n,e,r,o){var u={};4===arguments.length&&(u.key=Array.isArray(r)?r:[r]),3===arguments.length&&(o=r,r=null),u.value=Array.isArray(e)?e:[e];var i=[],a=this.db.transaction(n,t.READ_WRITE);a.onabort=function(n){return o&&"function"==typeof o?o(n.target.error):void 0},a.onerror=function(n){return o&&"function"==typeof o?o(n.target.error):void 0},a.oncomplete=function(){return i=1===i.length?i[0]:i,o&&"function"==typeof o?o(null,i):void 0};for(var c=a.objectStore(n),f=function(n,t){var e=c.put(n,t);e.onsuccess=function(n){i.push(n.target.result)},e.onerror=function(n){return o&&"function"==typeof o?o(n.target.error):void 0}},s=0;s<u.value.length;s++)u.key?f(u.value[s],u.key[s]):f(u.value[s])},"delete":function(n,e,r){var o=this.db.transaction(n,t.READ_WRITE);o.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},o.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},o.oncomplete=function(){return r&&"function"==typeof r?r(null):void 0};var u=o.objectStore(n),i=u.delete(e);i.onsuccess=function(){},i.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},clear:function(n,e){var r=this.db.transaction(n,t.READ_WRITE);r.onabort=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},r.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},r.oncomplete=function(){return e&&"function"==typeof e?e(null):void 0};var o=r.objectStore(n),u=o.clear();u.onsuccess=function(){},u.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0}}},n});