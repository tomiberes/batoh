!function(){"use strict";{var n=window.Batoh={},t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;window.IDBTransaction||window.webkitIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange||window.webkitIDBKeyRange}window.IDBCursor=window.IDBCursor||window.webkitIDBCursor||window.mozIDBCursor||window.msIDBCursor;var r=n.Pocket=function(n){this.setup={database:"Batoh",version:1,stores:{store:{keyPath:null,autoIncrement:!0,indexes:[]}}};for(var t in this.setup)this.setup[t]="undefined"!=typeof n[t]?n[t]:this.setup[t];this.db=null};r.prototype={openDB:function(n){var r=this,e=t.open(r.setup.database,r.setup.version);e.onsuccess=function(t){r.db=t.target.result,n&&"function"==typeof n&&n(null)},e.onerror=function(t){n&&"function"==typeof n&&n(t.target.error)},e.onblocked=function(t){n&&"function"==typeof n&&n(t.target.error)},e.onupgradeneeded=function(n){r.db=n.target.result;for(var t in r.setup.stores){var e=r.setup.stores[t],o=r.db.createObjectStore(t,{keyPath:e.keyPath,autoIncrement:e.autoIncrement});for(var u in e.indexes)o.createIndex(e.indexes[u].name,e.indexes[u].keyPath)}}},closeDB:function(){this.db&&this.db.close()},deleteDB:function(n){if(t.deleteDatabase){var r=t.deleteDatabase(this.setup.database);r.onsuccess=function(t){return n&&"function"==typeof n?n(null,t.target.result):void 0},r.onerror=function(){},r.onblocked=function(){},r.onversionchange=function(){}}},add:function(n,t,r,e){var o={};4===arguments.length&&(o.key=Array.isArray(r)?r:[r]),3===arguments.length&&(e=r,r=null),o.value=Array.isArray(t)?t:[t];var u=[],i=this.db.transaction(n,"readwrite");i.onabort=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},i.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},i.oncomplete=function(){return e&&"function"==typeof e?(u=1===u.length?u[0]:u,e(null,u)):void 0};for(var a=i.objectStore(n),c=function(n,t){var r=a.add(n,t);r.onsuccess=function(n){u.push(n.target.result)},r.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0}},f=0;f<o.value.length;f++)o.key?c(o.value[f],o.key[f]):c(o.value[f])},get:function(n,t,r){var e=this.db.transaction(n,"readonly");e.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},e.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},e.oncomplete=function(){return r&&"function"==typeof r?r(null,i):void 0};var o=e.objectStore(n),u=o.get(t),i=null;u.onsuccess=function(n){i=n.target.result},u.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},query:function(n,t,r,e){3===arguments.length&&(e=r,r=null),2===arguments.length&&(e=t,t=null,r=null);var o=[],u=this.db.transaction(n,"readonly");u.onabort=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},u.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},u.oncomplete=function(){return e&&"function"==typeof e?e(null,o):void 0};var i=u.objectStore(n),a=i;if(null!==t&&t.index&&(a=i.index(t.index)),null!==t&&t.limit)var c=t.limit;var f;f=null===t?a.openCursor():a.openCursor(t.range,t.direction),f.onsuccess=function(n){var t=n.target.result;if(t){if(r?r(t.value):o.push(t.value),c&&(c--,0===c))return;t.continue()}},f.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0}},put:function(n,t,r,e){var o={};4===arguments.length&&(o.key=Array.isArray(r)?r:[r]),3===arguments.length&&(e=r,r=null),o.value=Array.isArray(t)?t:[t];var u=[],i=this.db.transaction(n,"readwrite");i.onabort=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},i.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0},i.oncomplete=function(){return u=1===u.length?u[0]:u,e&&"function"==typeof e?e(null,u):void 0};for(var a=i.objectStore(n),c=function(n,t){var r=a.put(n,t);r.onsuccess=function(n){u.push(n.target.result)},r.onerror=function(n){return e&&"function"==typeof e?e(n.target.error):void 0}},f=0;f<o.value.length;f++)o.key?c(o.value[f],o.key[f]):c(o.value[f])},"delete":function(n,t,r){var e=this.db.transaction(n,"readwrite");e.onabort=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},e.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0},e.oncomplete=function(){return r&&"function"==typeof r?r(null):void 0};var o=e.objectStore(n),u=o.delete(t);u.onsuccess=function(){},u.onerror=function(n){return r&&"function"==typeof r?r(n.target.error):void 0}},clear:function(n,t){var r=this.db.transaction(n,"readwrite");r.onabort=function(n){return t&&"function"==typeof t?t(n.target.error):void 0},r.onerror=function(n){return t&&"function"==typeof t?t(n.target.error):void 0},r.oncomplete=function(){return t&&"function"==typeof t?t(null):void 0};var e=r.objectStore(n),o=e.clear();o.onsuccess=function(){},o.onerror=function(n){return t&&"function"==typeof t?t(n.target.error):void 0}}}}();